# 地理位置打卡系統使用指南

## 📍 系統概述

我們的智能打卡系統已升級為基於地理位置的驗證機制，確保員工必須在公司附近 **100 公尺範圍內** 才能完成打卡，有效防止遠程打卡行為。

## 🏢 管理員設定指南

### 1. 設定公司地理位置

1. 使用 `super_admin` 或 `company_admin` 帳號登入系統
2. 進入 **後台管理** → **公司管理**
3. 編輯公司資料，填入以下資訊：
   - **公司名稱**：公司名稱
   - **地址**：公司完整地址
   - **緯度 (Latitude)**：例如 `25.033` (台北市區)
   - **經度 (Longitude)**：例如 `121.565` (台北市區)

### 2. 如何獲取精確座標

**方法一：Google Maps**
1. 開啟 [Google Maps](https://maps.google.com)
2. 搜尋您的公司地址
3. 右鍵點擊公司位置
4. 選擇座標數字，自動複製到剪貼簿
5. 貼到系統的經緯度欄位

**方法二：手機 GPS**
1. 站在公司入口處
2. 使用手機的 GPS 定位 App
3. 記錄顯示的經緯度數值

## 📱 員工打卡指南

### 1. 打卡流程

1. **登入系統**：使用員工帳號登入
2. **選擇打卡類型**：選擇「上班」或「下班」
3. **點擊打卡按鈕**：系統會自動：
   - 請求位置權限（首次使用需允許）
   - 獲取您的 GPS 位置
   - 計算與公司的距離
   - 驗證是否在允許範圍內

### 2. 打卡成功
✅ 顯示訊息：「Check-in successful 距離公司: 45.2m」
✅ 記錄完整的打卡時間和位置資訊

### 3. 打卡失敗情況

❌ **距離超出範圍**
- 錯誤訊息：「您距離公司 150.5m，請在 100m 範圍內打卡」
- 解決方法：移動到公司附近再重新打卡

❌ **位置權限被拒絕**
- 錯誤訊息：「使用者拒絕位置存取權限」
- 解決方法：
  1. 開啟瀏覽器設定
  2. 允許位置存取權限
  3. 重新整理頁面

❌ **無法獲取位置**
- 錯誤訊息：「位置資訊無法取得」
- 解決方法：
  1. 確認 GPS 功能已開啟
  2. 移動到空曠處，避免建築物遮蔽
  3. 等待 GPS 訊號穩定後重試

## 🔧 技術規格

- **距離限制**：100 公尺
- **定位精度**：高精度 GPS (通常 3-5 公尺誤差)
- **計算方式**：Haversine 公式 (地球表面距離)
- **支援瀏覽器**：Chrome, Safari, Firefox (需支援 HTML5 Geolocation)

## 🛡️ 安全特性

✅ **防遠程打卡**：嚴格的距離驗證
✅ **防篡改**：後端最終驗證，前端無法偽造
✅ **完整記錄**：每次打卡都記錄詳細位置資訊
✅ **高精度定位**：使用最高精度的 GPS 定位

## ❓ 常見問題

**Q: 我在公司內，但系統顯示距離超出範圍？**
A: 可能是 GPS 訊號不佳，建議移動到窗邊或空曠處重新打卡。

**Q: 公司有多個出入口，都可以打卡嗎？**
A: 是的，只要在公司設定位置的 100 公尺範圍內都可以打卡。

**Q: 手機沒有 GPS 功能怎麼辦？**
A: 系統需要 GPS 定位功能，建議使用支援 GPS 的裝置。

**Q: 如果公司沒有設定地理位置會怎樣？**
A: 系統會保持向後相容，仍可正常打卡，但不會進行距離驗證。

## 📞 技術支援

如有任何問題，請聯繫系統管理員或技術支援團隊。

---

**系統版本**: 2.0
**更新日期**: 2024-09-20
**功能狀態**: ✅ 已上線